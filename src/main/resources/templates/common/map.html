<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<div th:fragment="map">
    <script th:inline="javascript">
        var map;

        function initMap() {
            var infowindow = new google.maps.InfoWindow();
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat:0,lng:0},
                zoom: 2
            });
            for(var i = 0; i < plots.length; i++) {
                var latlng = new google.maps.LatLng(plots[i].latitude, plots[i].longitude);
                console.log(plots[i]);
                var marker = new google.maps.Marker({
                    position: latlng,
                    map: map,
                    icon: '../../assets/img/tree-2-32.png'
                });
                google.maps.event.addListener(marker, 'click', (function(marker, i) {

                    return function() {
                        var contentString = "<div id='infowindow'>" +
                                "<h5>Plot id: "+ plots[i].id.toString() +"</h5>" +
                                "<p>Project:" +
                            "Plot id:"+ plots[i].id.toString() +"</div>" +
                            "</p>";
                        //infowindow.close();
                        infowindow.setContent(contentString);
                        infowindow.open(map, marker);
                    }

                })(marker, i));
            }
        }
        //google.maps.event.addDomListener(window, 'load', initMap);
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCf532UCd9nQEUc0fhK1qe4cdk1ppXkAzQ&callback=initMap"></script>
</div>
</html>